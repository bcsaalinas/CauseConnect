<%- include('../layouts/header', { title, page: 'directory', extraCss }) %>

<section class="page-section directory-hero snap-target" data-animate="section">
  <div class="content-max">
    <div class="section-heading text-center fade-up" data-animate="stagger">
      <p class="eyebrow text-uppercase mb-2">ngo directory</p>
      <h1 class="hero-title fs-1 mb-3" data-animate="split-lines">Discover causes near you</h1>
      <p class="hero-subtitle fs-5 mb-0" data-animate="fade">Use filters to find organizations aligned with your interests and location.</p>
    </div>

    <div class="directory-banner">
      <div class="parallax-banner glass-panel" data-animate="mask">
        <div class="parallax-banner__bg" data-parallax="0.22"></div>
        <div class="parallax-banner__content d-flex flex-column flex-md-row align-items-md-center gap-3">
          <div class="flex-grow-1">
            <h2 class="h4 mb-2">Filter smarter, connect faster</h2>
            <p class="mb-0">Dial in location, focus area, and SDG alignment to surface the organizations that benefit most from your time and resources.</p>
          </div>
          <div class="d-inline-flex gap-2">
            <span class="badge-soft">Real-time updates</span>
            <span class="badge-soft">Verified NGOs</span>
          </div>
        </div>
      </div>
    </div>

    <div class="directory-filter glass-panel fade-up" data-animate="float-card">
      <form class="directory-form" method="GET" action="/directory" data-animate="stagger" data-stagger-target=".directory-input, .directory-submit">
        <div class="directory-form-row">
          <label class="visually-hidden" for="directory-search">Search by name or mission</label>
          <input
            id="directory-search"
            class="form-control directory-input"
            type="text"
            name="q"
            placeholder="Search organizations..."
            value="<%= q || '' %>"
          />

          <label class="visually-hidden" for="directory-cause">Filter by cause</label>
          <select class="form-select directory-input" id="directory-cause" name="cause">
            <option value="">All Causes</option>
            <% if (causes && causes.length) { %>
              <% causes.forEach(c => { %>
                <option value="<%= c %>" <%= cause===c?'selected':'' %>><%= c %></option>
              <% }) %>
            <% } %>
          </select>

          <label class="visually-hidden" for="directory-location">Filter by city</label>
          <select class="form-select directory-input" id="directory-location" name="location">
            <option value="">All Cities</option>
            <% if (cities && cities.length) { %>
              <% cities.forEach(city => { %>
                <option value="<%= city %>" <%= location===city?'selected':'' %>><%= city %></option>
              <% }) %>
            <% } %>
          </select>

          <button type="submit" class="btn btn-pill btn-pill-primary directory-submit" data-animate="magnet">Search</button>
        </div>
        <div class="directory-form-helper">
          <% const filtered = totalResults || (ngos && ngos.length) || 0; %>
          <span class="text-muted small"><%= filtered %> <%= filtered === 1 ? 'organization' : 'organizations' %> found</span>
          <% if (q) { %>
            <span class="badge-soft">Search: "<%= q %>"</span>
          <% } %>
          <% if (cause) { %>
            <span class="badge-soft">Cause: <%= cause %></span>
          <% } %>
          <% if (location) { %>
            <span class="badge-soft">City: <%= location %></span>
          <% } %>
        </div>
      </form>
    </div>
  </div>
</section>

<section class="page-section directory-results-section snap-target" data-animate="section">
  <div class="content-max">
    <% if (error) { %>
      <div class="directory-empty glass-panel text-center p-5 fade-up" data-animate="float-card">
        <h3 class="h4 mb-3 text-danger">‚ö†Ô∏è Error</h3>
        <p class="mb-4"><%= error %></p>
        <a href="/directory" class="btn btn-pill btn-pill-outline">Try again</a>
      </div>
    <% } else if (ngos && ngos.length) { %>
      <div class="directory-results fade-up" data-animate="stagger-cards" data-stagger-target=".directory-card">
        <% ngos.forEach(org => { %>
          <article class="directory-card glass-panel">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h3 class="h5 mb-0"><%= org.name %></h3>
              <div class="d-flex gap-2 align-items-center">
                <span class="badge-soft"><%= org.cause %></span>
                <% if (org.verified) { %>
                  <span class="badge-soft" title="Verified Organization">‚úì</span>
                <% } %>
              </div>
            </div>
            
            <div class="mb-2">
              <p class="text-muted small mb-1">
                üìç <%= org.location.city %>, <%= org.location.state %>
              </p>
              <% if (org.yearFounded) { %>
                <p class="text-muted small mb-0">Founded: <%= org.yearFounded %></p>
              <% } %>
            </div>

            <p class="flex-grow-1 mb-3"><%= org.mission.substring(0, 200) %><%= org.mission.length > 200 ? '...' : '' %></p>

            <div class="d-flex flex-column gap-2">
              <div class="d-flex justify-content-between align-items-center gap-2">
                <% if (org.website) { %>
                  <a href="<%= org.website %>" target="_blank" rel="noopener noreferrer" class="btn btn-pill btn-sm btn-outline-secondary">Visit Website</a>
                <% } else { %>
                  <span class="text-muted small">No website</span>
                <% } %>
              </div>

              <% if (org.email || org.phone) { %>
                <div class="text-muted small d-flex flex-wrap gap-3">
                  <% if (org.email) { %>
                    <span>‚úâÔ∏è <%= org.email %></span>
                  <% } %>
                  <% if (org.phone) { %>
                    <span>üìû <%= org.phone %></span>
                  <% } %>
                </div>
              <% } %>
            </div>
          </article>
        <% }) %>
      </div>
    <% } else { %>
      <div class="directory-empty glass-panel text-center p-5 fade-up" data-animate="float-card">
        <h3 class="h4 mb-3">No organizations found</h3>
        <p class="mb-4">Try adjusting your filters or search term to discover more Mexican NGOs.</p>
        <a href="/directory" class="btn btn-pill btn-pill-outline">Reset filters</a>
      </div>
    <% } %>
  </div>
</section>

<section class="page-section globalgiving-directory-section snap-target" data-animate="section" id="globalgiving">
  <div class="content-max">
    <div class="section-heading text-center fade-up" data-animate="stagger">
      <p class="eyebrow text-uppercase mb-2">global projects</p>
      <h2 data-animate="split-lines">Verified Projects from GlobalGiving</h2>
      <p class="mb-0">Discover real-time projects making impact around the world. All projects are verified by GlobalGiving.</p>
    </div>

    <div class="gg-projects-grid fade-up mt-4" id="gg-directory-results" data-animate="stagger-cards">
      <!-- Projects loaded via JavaScript -->
      <div class="directory-card glass-panel skeleton-loader">
        <div class="skeleton-header mb-3"></div>
        <div class="skeleton-text mb-2"></div>
        <div class="skeleton-text mb-3"></div>
        <div class="skeleton-progress mb-3"></div>
        <div class="skeleton-footer"></div>
      </div>
      <div class="directory-card glass-panel skeleton-loader">
        <div class="skeleton-header mb-3"></div>
        <div class="skeleton-text mb-2"></div>
        <div class="skeleton-text mb-3"></div>
        <div class="skeleton-progress mb-3"></div>
        <div class="skeleton-footer"></div>
      </div>
      <div class="directory-card glass-panel skeleton-loader">
        <div class="skeleton-header mb-3"></div>
        <div class="skeleton-text mb-2"></div>
        <div class="skeleton-text mb-3"></div>
        <div class="skeleton-progress mb-3"></div>
        <div class="skeleton-footer"></div>
      </div>
    </div>
  </div>
</section>

<script src="/js/directory-globalgiving.js" defer></script>
<%- include('../layouts/footer') %>
