<%- include('../layouts/header', { 
  title, 
  page: 'directory', 
  extraCss,
  extraScripts: ['/js/federal-programs.js']
}) %>

<section class="page-section directory-hero snap-target" data-animate="section">
  <div class="content-max">
    <div class="section-heading text-center fade-up" data-animate="stagger">
      <p class="eyebrow text-uppercase mb-2">ngo directory</p>
      <h1 class="hero-title fs-1 mb-3" data-animate="split-lines">Discover causes near you</h1>
      <p class="hero-subtitle fs-5 mb-0" data-animate="fade">Use filters to find organizations aligned with your interests and location.</p>
    </div>

    <div class="directory-banner">
      <div class="parallax-banner glass-panel" data-animate="mask">
        <div class="parallax-banner__bg" data-parallax="0.22"></div>
        <div class="parallax-banner__content d-flex flex-column flex-md-row align-items-md-center gap-3">
          <div class="flex-grow-1">
            <h2 class="h4 mb-2">Filter smarter, connect faster</h2>
            <p class="mb-0">Dial in location, focus area, and SDG alignment to surface the organizations that benefit most from your time and resources.</p>
          </div>
          <div class="d-inline-flex gap-2">
            <span class="badge-soft">Real-time updates</span>
            <span class="badge-soft">Verified NGOs</span>
          </div>
        </div>
      </div>
    </div>

    <div class="directory-filter glass-panel fade-up" data-animate="float-card">
      <form class="directory-form" method="GET" action="/directory" data-animate="stagger" data-stagger-target=".directory-input, .directory-submit">
        <div class="form-check mb-3">
          <input 
            class="form-check-input" 
            type="checkbox" 
            value="true" 
            id="showFederal" 
            name="showFederal"
            <%= showFederal === "true" ? 'checked' : '' %>
          >
          <label class="form-check-label" for="showFederal">
            Show Federal Programs
          </label>
        </div>
        <div class="directory-form-row">
          <label class="visually-hidden" for="directory-search">Search by name</label>
          <input
            id="directory-search"
            class="form-control directory-input"
            type="text"
            name="q"
            placeholder="Search by name..."
            value="<%= q || '' %>"
          />

          <label class="visually-hidden" for="directory-cause">Filter by cause</label>
          <select class="form-select directory-input" id="directory-cause" name="cause">
            <option value="">Select cause</option>
            <option value="Education" <%= cause==='Education'?'selected':'' %>>Education</option>
            <option value="Environment" <%= cause==='Environment'?'selected':'' %>>Environment</option>
            <option value="Health" <%= cause==='Health'?'selected':'' %>>Health</option>
          </select>

          <label class="visually-hidden" for="directory-location">Filter by location</label>
          <select class="form-select directory-input" id="directory-location" name="location">
            <option value="">Select location</option>
            <option value="Guadalajara" <%= location==='Guadalajara'?'selected':'' %>>Guadalajara</option>
            <option value="Zapopan" <%= location==='Zapopan'?'selected':'' %>>Zapopan</option>
            <option value="Tlaquepaque" <%= location==='Tlaquepaque'?'selected':'' %>>Tlaquepaque</option>
            <option value="Jalisco" <%= location==='Jalisco'?'selected':'' %>>Regional / Jalisco</option>
          </select>

          <button type="submit" class="btn btn-pill btn-pill-primary directory-submit" data-animate="magnet">Search</button>
        </div>
        <div class="directory-form-helper">
          <% const filtered = (ngos && ngos.length) ? ngos.length : 0; %>
          <span class="text-muted small"><%= filtered %> <%= filtered === 1 ? 'result' : 'results' %></span>
          <% if (cause) { %>
            <span class="badge-soft">Cause: <%= cause %></span>
          <% } %>
          <% if (location) { %>
            <span class="badge-soft">Location: <%= location %></span>
          <% } %>
        </div>
      </form>
    </div>
  </div>
</section>

<section class="page-section directory-results snap-target" data-animate="section">
  <div class="content-max">
    <% if (ngos && ngos.length) { %>
      <div class="row g-4 row-cols-1 row-cols-sm-2 row-cols-lg-3 fade-up stagger-children" data-animate="stagger-cards" data-stagger-target=".directory-card" data-skew-target=".directory-card">
        <% ngos.forEach(item => { %>
          <div class="col">
            <article class="directory-card glass-panel h-100 p-4 d-flex flex-column reveal-mask" data-animate="mask">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <h3 class="h5 mb-0"><%= item.name %></h3>
                <span class="badge-soft"><%= item.cause %></span>
              </div>
              <p class="text-muted small mb-3"><%= item.location %></p>
              <p class="flex-grow-1 mb-3"><%= item.blurb %></p>
              <div class="d-flex justify-content-between align-items-center gap-2">
                <a href="<%= item.website %>" target="_blank" class="btn btn-pill btn-sm btn-outline-secondary">Visit site</a>
                <% if (item.contact) { %>
                  <span class="text-muted small"><%= item.contact %></span>
                <% } %>
              </div>
            </article>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <div class="directory-empty glass-panel text-center p-5 fade-up" data-animate="float-card">
        <h3 class="h4 mb-3">No matches yet</h3>
        <p class="mb-4">Try adjusting your filters or search term to discover more organizations.</p>
        <a href="/ngos" class="btn btn-pill btn-pill-outline">Reset filters</a>
      </div>
    <% } %>

    <% if (federalPrograms && federalPrograms.programs.length > 0) { %>
      <div class="federal-programs mt-5">
        <h2 class="h4 mb-4">Federal Programs</h2>
        <div class="row g-4">
          <% federalPrograms.programs.forEach(program => { %>
            <div class="col-12 col-md-6">
              <div class="program-card glass-panel p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <h3 class="h5 mb-0"><%= program.name %></h3>
                  <% if (program.acronym) { %>
                    <span class="badge-soft"><%= program.acronym %></span>
                  <% } %>
                </div>
                <p class="mb-3 small"><%= program.description %></p>
                <div class="program-details small">
                  <p class="mb-2"><strong>Focus Area:</strong> <%= program.focusArea %></p>
                  <% if (program.responsible) { %>
                    <p class="mb-2"><strong>Contact:</strong> <%= program.responsible %></p>
                  <% } %>
                  <% if (program.email) { %>
                    <p class="mb-2"><strong>Email:</strong> <a href="mailto:<%= program.email %>"><%= program.email %></a></p>
                  <% } %>
                  <% if (program.website) { %>
                    <a href="<%= program.website %>" target="_blank" class="btn btn-pill btn-pill-outline btn-sm mt-3">Learn More</a>
                  <% } %>
                </div>
              </div>
            </div>
          <% }); %>
        </div>

        <% if (federalPrograms.totalPages > 1) { %>
          <div class="pagination-controls mt-4 d-flex justify-content-center">
            <nav aria-label="Federal programs pagination">
              <ul class="pagination">
                <li class="page-item <%= federalPrograms.currentPage === 1 ? 'disabled' : '' %>">
                  <a class="page-link" href="?<%= new URLSearchParams({
                    q: q || '',
                    cause: cause || '',
                    location: location || '',
                    showFederal: 'true',
                    page: (federalPrograms.currentPage - 1).toString()
                  }).toString() %>" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
                
                <% for(let i = 1; i <= federalPrograms.totalPages; i++) { %>
                  <li class="page-item <%= federalPrograms.currentPage === i ? 'active' : '' %>">
                    <a class="page-link" href="?<%= new URLSearchParams({
                      q: q || '',
                      cause: cause || '',
                      location: location || '',
                      showFederal: 'true',
                      page: i.toString()
                    }).toString() %>">
                      <%= i %>
                    </a>
                  </li>
                <% } %>
                
                <li class="page-item <%= federalPrograms.currentPage === federalPrograms.totalPages ? 'disabled' : '' %>">
                  <a class="page-link" href="?<%= new URLSearchParams({
                    q: q || '',
                    cause: cause || '',
                    location: location || '',
                    showFederal: 'true',
                    page: (federalPrograms.currentPage + 1).toString()
                  }).toString() %>" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        <% } %>
      </div>
    <% } %>
  </div>
</section>

<section class="page-section directory-showcase snap-target" data-animate="section">
  <div class="content-max">
    <div class="section-heading text-center fade-up" data-animate="stagger">
      <p class="eyebrow text-uppercase mb-2">featured initiatives</p>
      <h2 data-animate="split-lines">Explore SDG-focused projects at a glance</h2>
      <p class="mb-0">Swipe or scroll horizontally to preview highlighted organizations before diving deeper.</p>
    </div>
    <div class="horizontal-showcase" data-animate="horizontal-gallery">
      <div class="showcase-track">
        <div class="showcase-card glass-panel reveal-mask p-4" data-animate="mask">
          <span class="badge-soft mb-3 d-inline-block text-uppercase small">SDG 3</span>
          <h3 class="h5 mb-2">Heal Jalisco Collective</h3>
          <p class="mb-3 small text-muted">Mobile clinics offering preventative care across rural communities.</p>
          <a href="/directory?q=Heal+Jalisco" class="btn btn-pill btn-pill-outline btn-sm">View profile</a>
        </div>
        <div class="showcase-card glass-panel reveal-mask p-4" data-animate="mask">
          <span class="badge-soft mb-3 d-inline-block text-uppercase small">SDG 11</span>
          <h3 class="h5 mb-2">Urban Roots Lab</h3>
          <p class="mb-3 small text-muted">Designing greener public spaces with resident-led stewardship.</p>
          <a href="/directory?q=Urban+Roots" class="btn btn-pill btn-pill-outline btn-sm">View profile</a>
        </div>
        <div class="showcase-card glass-panel reveal-mask p-4" data-animate="mask">
          <span class="badge-soft mb-3 d-inline-block text-uppercase small">SDG 5</span>
          <h3 class="h5 mb-2">Emerging Leaders MX</h3>
          <p class="mb-3 small text-muted">Leadership training &amp; funding pathways for women-led NGOs.</p>
          <a href="/directory?q=Emerging+Leaders" class="btn btn-pill btn-pill-outline btn-sm">View profile</a>
        </div>
        <div class="showcase-card glass-panel reveal-mask p-4" data-animate="mask">
          <span class="badge-soft mb-3 d-inline-block text-uppercase small">SDG 13</span>
          <h3 class="h5 mb-2">Climate Action Fellows</h3>
          <p class="mb-3 small text-muted">Youth fellows monitoring urban emissions with open data dashboards.</p>
          <a href="/directory?q=Climate+Action+Fellows" class="btn btn-pill btn-pill-outline btn-sm">View profile</a>
        </div>
      </div>
    </div>
  </div>
</section>

<%- include('../layouts/footer') %>
